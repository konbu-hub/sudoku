# 🚀 Sudoku App Development Journey: コンセプトからローンチまでの全記録

| プロジェクト | Cyber-Cookie Sudoku |
| :--- | :--- |
| **オーナー** | User (Product Owner / Visionary) |
| **開発リード** | Antigravity (Lead Developer / AI) |
| **ステータス** | 🚀 リリース済み (Launched) |

本ドキュメントは、単なる「数独アプリ」がどのようにして「サイバーパンク」と「クッキー」という異色のテーマを纏い、技術的な壁を乗り越えてクラウド上で稼働するに至ったか、その詳細な開発プロセスを記録したものです。

---

## 📖 はじめに: プロジェクトの概要

「普通の数独では面白くない」。
本プロジェクトは、ユーザーのこの想いからスタートしました。目指したのは、使いやすさと、一度見たら忘れられないビジュアルインパクトを兼ね備えたWebアプリケーションです。

---

## 📅 Phase 1: 概念実証 (MVP: Minimum Viable Product)

**プロジェクトの始動**
最初のステップは、ゲームとして成立する最小限の機能を実装することでした。

### 👤 User's Vision (指示と判断)
*   **技術選定**: バックエンドにはPython (Flask) を使用すること。
*   **コア機能**: 難易度調整が可能な、標準的な数独ゲームのロジックを作成すること。

### 🤖 Antigravity's Execution (技術的アプローチ)
*   **アルゴリズムの実装 (`sudoku_engine.py`)**:
    *   数独の生成には「バックトラッキング法（再帰的探索）」を採用しました。
    *   適当に数字を埋めるのではなく、**「唯一の解を持つパズル」** を生成するために、一度完成させた盤面から、難易度に応じてランダムに数字を抜き取るロジック（穴あけ法）を実装しました。
*   **API設計**:
    *   フロントエンドとバックエンドを分離するため、`/api/puzzle` や `/api/score` といったRESTfulなエンドポイントを設計。これにより、後の拡張（リッチなUIへの変更）が容易になりました。

---

## 🎨 Phase 2: "Cyber-Cookie" というアイデンティティ (Design & Theme)

**世界観の構築**
機能ができた後、このアプリに魂を吹き込むプロセスが始まりました。

### 👤 User's Vision (指示と判断)
*   **テーマの融合**: 「サイバーパンク（未来的・ネオン）」と「クッキー（ポップ・可愛い）」という、一見相反する要素を融合させたい。
*   **ビジュアルへのこだわり**:
    *   ダークモードを基本とする。
    *   生成AIで作った「サイバーなクッキー」のアイコンを配置したい。

### 🤖 Antigravity's Execution (技術的アプローチ)
*   **CSS変数によるテーマ設計**:
    *   `--primary-color`: ネオンシアン (`#00f3ff`)
    *   `--secondary-color`: ホットピンク (`#ff00ff`)
    *   これらを随所に使用し、黒背景に対するコントラストを極限まで高めました。
*   **グラスモーフィズム (Glassmorphism)**:
    *   ゲームボードやモーダルの背景に「すりガラス効果 (`backdrop-filter: blur`)」を採用。近未来感を演出しています。
*   **動的演出 (`game.js` & CSS)**:
    *   背景に浮遊するクッキーのアイコンを配置。CSS Animation (`@keyframes float`) でふわふわと動かし、静的な画面にリズムを与えました。

---

## 🌏 Phase 3: 体験の向上とローカライズ (UX & L10n)

**日本ユーザーへの最適化**
海外製のテンプレートのような印象を払い拭き、日本のユーザーが直感的に楽しめるよう調整を行いました。

### 👤 User's Vision (指示と判断)
*   **完全日本語化**: メニュー、ルール説明、エラーメッセージに至るまで、自然な日本語にする。
*   **ゲームバランスの調整**:
    *   「なんとなくクリアできた」を防ぐため、緊張感を持たせたい。
    *   **「3回ミスでゲームオーバー」** という明確なペナルティを追加。
    *   **「ヒントは3回まで」** という制限を追加。

### 🤖 Antigravity's Execution (技術的アプローチ)
*   **状態管理の厳格化**:
    *   `game.js` 内で `mistakes`（ミス回数）と `hintCount`（ヒント使用回数）変数を管理。
    *   入力があるたびにサーバー側の正解データと照合するのではなく、初回ロード時に持たせた正解データ(`solution`)とクライアントサイドで照合することで、レスポンスの速さを確保（UX向上）しました。
*   **チュートリアルの実装**:
    *   初回訪問者向けに、追加された独自ルールを説明するモーダルウィンドウを実装しました。

---

## ☁️ Phase 4: クラウドへの挑戦 - データベース移行 (Database Migration)

**最大の技術的ハードル**
ローカル環境では完璧に動作していたアプリが、クラウド（Vercel）上で最大の課題に直面しました。

### 👤 User's Vision (指示と判断)
*   **課題報告**: 「Vercelにデプロイしたら、リロードするたびにランキングが消えてしまう」
*   **要求**: サーバーを再起動してもデータが消えない、永続的なランキング機能が欲しい。

### 🤖 Antigravity's Execution (技術的アプローチ)
*   **原因分析**:
    *   アプリは当初 `SQLite` (`sudoku.db`) を使用していました。
    *   Vercelのようなサーバーレス環境（FaaS）は、**Ephemeral Filesystem（一時的なファイルシステム）** で動作します。デプロイや再起動のたびに保存していたファイルはリセットされる仕様でした。
*   **アーキテクチャの変更**:
    *   **ハイブリッドDB構成**: ローカル開発のしやすさ（SQLite）と、本番環境の堅牢性（PostgreSQL）を両立させるため、`database.py` を完全に書き換えました。
    *   **DBConnectionクラス**: 環境変数 `POSTGRES_URL` (または `DATABASE_URL`) の有無を検知し、自動的に接続先を切り替えるラッパーを作成しました。
    *   **クエリの抽象化**: PostgreSQL (`%s`) と SQLite (`?`) でSQLのプレースホルダ構文が異なる問題を吸収する `query_wrapper` 関数を実装し、コードの共通化に成功しました。

---

## 🔧 Phase 5: ラストマイル - デプロイとデバッグ (Stabilization)

**見えないエラーとの戦い**
データベース移行後も、本番環境での稼働にはいくつかの壁がありました。ここでのユーザーとの協力体制がローンチの鍵となりました。

### 🛠️ 課題 1: 依存関係の衝突
*   **現象**: `psycopg2` (PostgreSQLドライバ) の特定バージョンがVercel環境でビルドエラーを引き起こした。
*   **解決**: `requirements.txt` のバージョン指定 (`==0.40.0`) を削除し、システムに最適なバージョンを自動解決させることで解消。

### 🛠️ 課題 2: 設定ファイル (`vercel.json`) の警告
*   **現象**: 古い形式 (`builds`) の設定が残っており、Vercelのプロジェクト設定と競合していた。
*   **解決**: モダンな設定形式 (`rewrites`) に書き換え、構成をシンプル化。

### 🛠️ 課題 3: エントリーポイントの喪失
*   **現象**: 設定ファイルを書き換えた結果、ルートディレクトリの `app.py` が自動認識されなくなり、アプリが起動しなくなった。
*   **解決**: VercelのBest Practiceに従い、`api/index.py` を作成。ここから親ディレクトリの `app` をインポートする構成に変更し、**Zero-Config Deployment** の流れに乗せました。

### 🛠️ 課題 4: 環境変数のミステリーと解決
*   **現象**: デバッグ用エンドポイント (`/api/debug/db`) を作成して確認したところ、DB接続設定が空 (`url_configured: false`) であることが判明。
*   **ユーザーの協力**: Vercelの管理画面のスクリーンショットを提供いただく。
*   **解決**: Neon統合機能が `POSTGRES_URL` ではなく `DATABASE_URL` という名前で変数を提供していることを特定。コード側で両方の変数名に対応させることで、ついにデータベース接続に成功。

---

## 🏆 結論: プロジェクトの成果

本プロジェクトは、単なるプログラミングの実装作業を超えた、**「対話によるアジャイルな製品開発」** の好例となりました。

*   **ユーザーの役割**: 明確なビジョン（「サイバー×クッキー」）、迅速なフィードバック（エラー報告・スクショ共有）、そして重要な場面での意思決定。
*   **Antigravityの役割**: ビジョンの具現化、技術的課題の根本原因分析、そして拡張性のあるアーキテクチャ設計。

結果として、**「デザイン性」「操作性」「技術的堅牢性」** の三拍子が揃った、ユニークな数独アプリケーションがここに完成しました。

**Mission Complete.**
